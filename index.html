<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Goal Path</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: transparent;
            color: white;
            height: 100vh;
            width: 100vw;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            user-select: none;
        }

        .wrapper {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: grab;
            position: relative;
        }

        .wrapper:active {
            cursor: grabbing;
        }

        .goal-container {
            width: 100%;
            height: 100%;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .goal {
            padding: 8px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 5px;
            color: white;
            border: none;
            outline: none;
            width: 100%; /* ✅ Auto-resizes */
            height: 100%; /* ✅ Auto-resizes */
            resize: none; /* Prevent default resizing */
            font-size: 1em;
            cursor: grab; /* ✅ Allows dragging inside */
        }

        /* ✅ Much Smaller Resize Handle */
        #resize-handle {
            width: 8px;  /* Smaller width */
            height: 8px;  /* Smaller height */
            position: absolute;
            bottom: 2px;  /* Slightly offset */
            right: 2px;   /* Slightly offset */
            cursor: nwse-resize;
            background: transparent;
            border-radius: 50%;
        }
    </style>
</head>
<body>
    <div class="wrapper" id="drag-area">
        <div class="goal-container">
            <textarea class="goal" id="goal-input" placeholder="Enter your goal"></textarea>
        </div>
        <div id="resize-handle"></div> <!-- ✅ Smaller Resize Handle -->
    </div>

    <script>
        const { ipcRenderer } = require("electron");

        document.addEventListener("DOMContentLoaded", () => {
            const wrapper = document.getElementById("drag-area");
            const resizeHandle = document.getElementById("resize-handle");
            const goalInput = document.getElementById("goal-input");

            let isDragging = false;
            let isResizing = false;
            let startX, startY, startWidth, startHeight;

            // ✅ Dragging behavior (Click anywhere including inside input field)
            function startDragging(e) {
                if (e.target === resizeHandle) return; // Prevent dragging when resizing
                isDragging = true;
                startX = e.screenX;
                startY = e.screenY;
                wrapper.style.cursor = "grabbing";
            }

            function stopDragging() {
                isDragging = false;
                isResizing = false;
                wrapper.style.cursor = "grab";
            }

            function moveWindow(e) {
                if (isDragging) {
                    ipcRenderer.send("move-window", {
                        deltaX: e.screenX - startX,
                        deltaY: e.screenY - startY
                    });
                    startX = e.screenX;
                    startY = e.screenY;
                }

                if (isResizing) {
                    const newWidth = startWidth + (e.clientX - startX);
                    const newHeight = startHeight + (e.clientY - startY);

                    ipcRenderer.send("resize-window", { width: newWidth, height: newHeight });

                    // ✅ Dynamically resize input field
                    goalInput.style.width = `${newWidth - 20}px`;  // Adjust for padding
                    goalInput.style.height = `${newHeight - 20}px`;
                }
            }

            // ✅ Allow dragging inside the input field
            goalInput.addEventListener("mousedown", startDragging);
            wrapper.addEventListener("mousedown", startDragging);
            document.addEventListener("mousemove", moveWindow);
            document.addEventListener("mouseup", stopDragging);

            // ✅ Resizing behavior (Only bottom-right corner)
            resizeHandle.addEventListener("mousedown", (e) => {
                e.preventDefault();
                isResizing = true;
                startX = e.clientX;
                startY = e.clientY;
                const bounds = ipcRenderer.sendSync("get-window-bounds");
                startWidth = bounds.width;
                startHeight = bounds.height;
            });
        });
    </script>
</body>
</html>
